/* --- Chat Panel --- */
.chat-panel {
  flex: 1; display: flex; flex-direction: column; background-color: rgba(233, 224, 248, 0.9); border-left: 2px solid #1e1e2f; border-radius: 0 var(--radius-lg) var(--radius-lg) 0; height: 100%; max-height: 100vh; overflow: hidden;
}
.chat-header {
  height: var(--top-bar-height);
  box-sizing: border-box;
  padding: 0 1rem;
  padding-top: var(--safe-area-inset-top);
  padding-right: calc(1rem + var(--safe-area-inset-right));
  padding-left: calc(1rem + var(--safe-area-inset-left));
  background-color: rgba(44, 44, 62, 0.7);
  backdrop-filter: blur(5px);
  color: var(--font-color);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  position: relative;
  gap: 0.75rem;
  top: 7px;
}
.chat-header-avatar-button { background: none; border: none; padding: 0; cursor: pointer; border-radius: 50%; line-height: 0; }
.chat-header-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; object-position: top; border: 2px solid var(--primary-accent); transition: transform 0.2s ease; }
.chat-header-avatar-button:hover .chat-header-avatar, .chat-header-avatar-button:focus .chat-header-avatar { transform: scale(1.1); }
.chat-header h2 { font-size: 1.2rem; margin: 0; flex-grow: 1; text-align: left; }
.chat-modal-close { display: none; position: absolute; top: 50%; right: 0.5rem; transform: translateY(-50%); background: none; border: none; color: #fff; cursor: pointer; padding: 0.5rem; }
.chat-modal-close svg { display: block; }

.chat-messages {
  flex-grow: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem;
}
.message-container { display: flex; max-width: 85%; }
.message-container.human { align-self: flex-end; justify-content: flex-end; }
.message-container.ai { align-self: flex-start; justify-content: flex-start; }
.message {
  padding: 0.6rem 1rem; border-radius: var(--radius-md); color: var(--black-suit); line-height: 1.4; font-size: 0.95rem; word-break: break-word; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.message strong { font-weight: 900; }
.message-container.ai .message { background-color: #fff; border-bottom-left-radius: 4px; }
.message-container.human .message { background-color: var(--human-bubble); border-bottom-right-radius: 4px; }
.typing-indicator span { height: 8px; width: 8px; background-color: #888; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
.typing-indicator span:nth-of-type(1) { animation-delay: -0.32s; }
.typing-indicator span:nth-of-type(2) { animation-delay: -0.16s; }


.chat-input-form {
  display: flex;
  height: var(--bottom-bar-height);
  box-sizing: border-box;
  align-items: center;
  padding: 0 0.75rem;
  padding-right: calc(0.75rem + var(--safe-area-inset-right));
  padding-left: calc(0.75rem + var(--safe-area-inset-left));
  padding-bottom: var(--safe-area-inset-bottom);
  border-top: 1px solid var(--border-color);
  background-color: #fff;
  gap: 0.5rem;
  position: relative;
  bottom: -6px;
}
.chat-input-wrapper { position: relative; flex-grow: 1; }
.chat-input-form input {
  width: 100%;
  border: 1px solid #ccc;
  border-radius: var(--radius-full);
  padding: 0.6rem 4.5rem 0.6rem 1rem;
  font-size: 1rem;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.chat-input-form input:focus { border-color: var(--primary-accent); box-shadow: 0 0 5px rgba(var(--primary-accent-rgb), 0.5); }
.chat-input-form button { background: none; border: none; cursor: pointer; padding: 0 0.5rem 0 0.5rem; color: var(--primary-accent); transition: color 0.2s; align-self: center; }
.chat-input-form button:hover, .chat-input-form button:focus { color: var(--primary-accent-hover); }
.chat-input-form button:disabled { color: #aaa; cursor: not-allowed; }
.char-counter {
  position: absolute;
  top: 50%;
  right: 2.5rem;
  transform: translateY(-50%);
  font-size: 0.8rem;
  color: #888;
  pointer-events: none;
}
.char-counter.limit-near { color: var(--red-suit); font-weight: bold; }

@media (max-width: 1024px) {
  .chat-panel { position: fixed; top: 0; right: 0; width: 100%; height: 100%; z-index: 1000; border-radius: 0; border: none; transform: translateX(100%); transition: transform 0.3s ease-in-out; box-shadow: -5px 0 15px rgba(0,0,0,0.2); }
  .chat-modal-close { display: block; }
}
